{"version":3,"sources":["player.js"],"names":["game_scene","require","cc","Class","extends","Component","properties","initSpeed","max_power","y_radio","game_manager","type","default","touchArea","Node","scorePlusLabel","Label","scaleAudio","url","AudioClip","scoreA_Audio","score1_Audio","score2_Audio","score3_Audio","score4_Audio","score5_Audio","score6_Audio","score7_Audio","score8_Audio","onLoad","next_block","direction","set_next_block","block","start","score","rotate_node","node","getChildByName","anim_node","isPowering","speed","x_distance","isCombo","scoreAudioArr","on","EventType","TOUCH_START","e","stopAllActions","runAction","scaleTo","playScale","audioEngine","play","bind","TOUCH_END","stop","player_jump","TOUCH_CANCEL","y_distance","traget_pos","getPosition","x","y","w_pos","parent","convertToWorldSpaceAR","rotateBy","is_gameOver","test_pos","convertToNodeSpaceAR","jump","jumpTo","Math","random","end_func","callFunc","checkout_game","anim","getComponent","Animation","playAdditive","playScoreFn","play_blockLight","string","showScore","toString","move_map","seq","sequence","update","dt"],"mappings":"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","file":"player.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/class/index.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/reference/attributes/index.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/life-cycle-callbacks/index.html\r\n\r\nvar game_scene = require('game_scenes');\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        initSpeed: 150,\r\n        max_power: 600,\r\n        y_radio: 0.5560472,\r\n\r\n        game_manager: {\r\n            type: game_scene,\r\n            default: null,\r\n        },\r\n\r\n        touchArea: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n\r\n        scorePlusLabel:{\r\n            default: null,\r\n            type: cc.Label,\r\n        },\r\n\r\n        scaleAudio: {\r\n            default: null,\r\n            url: cc.AudioClip\r\n        },\r\n        // 得分音效资源\r\n        scoreA_Audio: {\r\n            default: null,\r\n            url: cc.AudioClip\r\n        },\r\n        score1_Audio: {\r\n            default: null,\r\n            url: cc.AudioClip\r\n        },\r\n        score2_Audio: {\r\n            default: null,\r\n            url: cc.AudioClip\r\n        },\r\n        score3_Audio: {\r\n            default: null,\r\n            url: cc.AudioClip\r\n        },\r\n        score4_Audio: {\r\n            default: null,\r\n            url: cc.AudioClip\r\n        },\r\n        score5_Audio: {\r\n            default: null,\r\n            url: cc.AudioClip\r\n        },\r\n        score6_Audio: {\r\n            default: null,\r\n            url: cc.AudioClip\r\n        },\r\n        score7_Audio: {\r\n            default: null,\r\n            url: cc.AudioClip\r\n        },\r\n        score8_Audio: {\r\n            default: null,\r\n            url: cc.AudioClip\r\n        },\r\n    },\r\n\r\n    onLoad() {\r\n        this.next_block = null;\r\n        this.direction = 1;\r\n    },\r\n\r\n    set_next_block(block) {\r\n        this.next_block = block;\r\n    },\r\n\r\n    start () {\r\n        this.score = 0;\r\n        // 获取 rotate 与 anim 节点\r\n        this.rotate_node = this.node.getChildByName('rotate');\r\n        this.anim_node = this.rotate_node.getChildByName('anim');\r\n        // 初始化蓄力状态；初始速度；X移动距离；开始方向\r\n        this.isPowering = false;\r\n        this.speed = 0;\r\n        this.x_distance = 0;\r\n        this.isCombo = 0;\r\n        this.scoreAudioArr = [this.score1_Audio,this.score2_Audio,this.score3_Audio,this.score4_Audio,this.score5_Audio,this.score6_Audio,this.score7_Audio,this.score8_Audio];\r\n\r\n        // 监听事件\r\n        this.touchArea.on(cc.Node.EventType.TOUCH_START, function (e) {\r\n            this.isPowering = true;\r\n            this.speed = this.initSpeed;\r\n            this.x_distance = 0;\r\n            // 先停止所有动画；压缩Y\r\n            this.anim_node.stopAllActions();\r\n            this.anim_node.runAction( cc.scaleTo(2, 1.2, 0.5) );\r\n            // 播放音效\r\n            this.playScale = cc.audioEngine.play(this.scaleAudio, true);\r\n        }.bind(this), this);\r\n\r\n\r\n        this.touchArea.on(cc.Node.EventType.TOUCH_END, function (e) {\r\n            this.isPowering = false;\r\n            // 先停止所有动画；恢复初始状态\r\n            this.anim_node.stopAllActions();\r\n            this.anim_node.runAction( cc.scaleTo(0.5, 1, 1) );\r\n\r\n            cc.audioEngine.stop(this.playScale);\r\n            this.player_jump();\r\n        }.bind(this), this);\r\n\r\n\r\n        this.touchArea.on(cc.Node.EventType.TOUCH_CANCEL, function (e) {\r\n            this.isPowering = false;\r\n            // 先停止所有动画；恢复初始状态\r\n            this.anim_node.stopAllActions();\r\n            this.anim_node.runAction( cc.scaleTo(0.5, 1, 1) );\r\n\r\n            cc.audioEngine.stop(this.playScale);\r\n            this.player_jump();\r\n        }.bind(this), this);\r\n    },\r\n\r\n    player_jump() {\r\n        // 获取XY移动距离；本身位置；加上移动的距离\r\n        var x_distance = this.x_distance * this.direction;\r\n        var y_distance = this.x_distance * this.y_radio;\r\n\r\n        var traget_pos = this.node.getPosition();\r\n        traget_pos.x += x_distance;\r\n        traget_pos.y += y_distance;\r\n        // 获取player父节点（世界）位置\r\n        var w_pos = this.node.parent.convertToWorldSpaceAR(traget_pos);\r\n        \r\n        this.rotate_node.runAction(cc.rotateBy(0.35, (360 * this.direction)));\r\n        var is_gameOver = false;\r\n        if(this.next_block.test_pos(w_pos, this.direction)){\r\n            // 转化 traget_pos 为参考点的位置\r\n            traget_pos = this.node.parent.convertToNodeSpaceAR(w_pos);\r\n        }else{\r\n            is_gameOver = true;\r\n        }\r\n        // 执行跳跃动画（时间，位置，高度，次数）\r\n        var jump = cc.jumpTo(0.35,traget_pos,200,1);\r\n\r\n        // 判断新 block 生成方向\r\n        this.direction = (Math.random() < 0.5) ? -1 : 1;\r\n\r\n        // 执行完跳跃后滚动地图\r\n        var end_func = cc.callFunc(function () {\r\n            if(is_gameOver){\r\n                this.game_manager.checkout_game();\r\n            }else{\r\n                var anim = this.node.getChildByName('score_plus').getComponent(cc.Animation);\r\n                anim.playAdditive('scoreAM');\r\n                // 播放音效 添加分数等等\r\n                if( this.next_block.playScoreFn() ){\r\n                    this.isCombo++;\r\n                    if(this.isCombo>8){this.isCombo=8;}\r\n                    this.next_block.play_blockLight().playAdditive('mid_lightAM');\r\n                    this.node.parent.getChildByName('score_plus')\r\n                    cc.audioEngine.play(this.scoreAudioArr[(this.isCombo-1)], false);\r\n                    this.score += 2 * this.isCombo;\r\n                    this.scorePlusLabel.string = '+' + 2 * this.isCombo;\r\n                }else{\r\n                    this.isCombo = 0;\r\n                    cc.audioEngine.play(this.scoreA_Audio, false);\r\n                    this.score ++;\r\n                    this.scorePlusLabel.string = '+1';\r\n                }\r\n                this.game_manager.showScore( this.score.toString() );\r\n                // 通过 game_manager 调用 game_scenes 的函数\r\n                if(this.direction == -1){\r\n                    this.game_manager.move_map(580 - w_pos.x);\r\n                }else{\r\n                    this.game_manager.move_map(180 - w_pos.x);\r\n                }\r\n            }\r\n        }.bind(this));\r\n        var seq = cc.sequence(jump, end_func);\r\n        this.node.runAction(seq);\r\n    },\r\n\r\n    update (dt) {\r\n        if(this.isPowering) {\r\n            this.speed += (this.max_power * dt);\r\n            this.x_distance += this.speed * dt;\r\n        }\r\n    },\r\n});\r\n"]}