{"version":3,"sources":["..\\..\\..\\..\\assets\\script/assets\\script\\game_scenes.js"],"names":["cc","Class","extends","Component","properties","player","default","type","Node","block_prefab","Prefab","block_root","left_org","p","camera_root","checkout","readyPage","y_radio","scoreLable","Label","endScoreLable","start_Audio","url","AudioClip","fall_Audio","startBtn","active","creat_block","audioEngine","play","start","cur_block","instantiate","Math","floor","random","addChild","setPosition","convertToNodeSpaceAR","world_pos","getChildByName","convertToWorldSpaceAR","next_block","playerComp","getComponent","block_zorder","block_tag","x_distance","y_distance","next_block_pos","getPosition","x","direction","y","play_blockDorp","playAdditive","set_next_block","move_map","offset_x","m1","moveBy","end_func","callFunc","bind","seq","sequence","runAction","showScore","score","string","checkout_game","scheduleOnce","game_again","director","loadScene"],"mappings":"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","file":"game_scenes.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/class/index.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/reference/attributes/index.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/life-cycle-callbacks/index.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        player: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        block_prefab: {\r\n            default: [],\r\n            type: cc.Prefab,\r\n        },\r\n        block_root: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        left_org : cc.p(0, 0),\r\n\r\n        camera_root: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n\r\n        checkout: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n\r\n        readyPage: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n\r\n        y_radio: 0.5560472,\r\n\r\n        scoreLable: {\r\n            default: null,\r\n            type: cc.Label,\r\n        },\r\n\r\n        endScoreLable: {\r\n            default: null,\r\n            type: cc.Label,\r\n        },\r\n\r\n        start_Audio: {\r\n            default: null,\r\n            url: cc.AudioClip\r\n        },\r\n\r\n        fall_Audio: {\r\n            default: null,\r\n            url: cc.AudioClip\r\n        },\r\n    },\r\n\r\n    startBtn() {\r\n        this.readyPage.active = false;\r\n        // 初始化一个\r\n        this.creat_block();\r\n        cc.audioEngine.play(this.start_Audio, false);\r\n    },\r\n\r\n    start () {\r\n        // 实例化一个 block_prefab；将其添加到 block_root；并添加位置节点\r\n        this.cur_block = cc.instantiate(this.block_prefab[Math.floor(Math.random() * 3)]);\r\n        this.block_root.addChild(this.cur_block);\r\n        this.cur_block.setPosition( this.block_root.convertToNodeSpaceAR(this.left_org) );\r\n\r\n        // 获取 cur_block 的中心点\r\n        let world_pos = this.cur_block.getChildByName('mid').convertToWorldSpaceAR( cc.p(0, 0) );\r\n        // 将 player 放置在 cur_block 的中心点\r\n        this.player.setPosition( this.camera_root.convertToNodeSpaceAR(world_pos) );\r\n        this.next_block = this.cur_block;\r\n        // 获取player节点的player脚本\r\n        this.playerComp = this.player.getComponent('player');\r\n        this.block_zorder = -1;\r\n        this.block_tag = 0;\r\n    },\r\n\r\n    creat_block () {\r\n        this.cur_block = this.next_block;\r\n        // 实例化一个 block_prefab，将其添加到 block_root，并设置层级\r\n        this.next_block = cc.instantiate(this.block_prefab[Math.floor(Math.random() * 3)]);\r\n        this.block_root.addChild(this.next_block,this.block_zorder,this.block_tag);\r\n        this.block_zorder--;\r\n        this.block_tag++;\r\n        // 超过XX个就清除\r\n        // let blockLen = this.block_root._children.length;\r\n        // if(blockLen > 5){\r\n        //     for (let i = 0; i < 3; i++) {\r\n        //         this.block_root.removeChildByTag(i);\r\n        //     }\r\n        //     this.block_tag = 0;\r\n        // }\r\n        // next_block 增加的距离，范围200-400\r\n        let x_distance = 200 + Math.random() * 200;\r\n        this.y_distance = x_distance * this.y_radio;\r\n        // 获取 cur_block 的位置，相加得到 next_block 的位置\r\n        let next_block_pos = this.cur_block.getPosition();\r\n        next_block_pos.x += (x_distance * this.playerComp.direction);\r\n        next_block_pos.y += this.y_distance;\r\n        this.next_block.setPosition(next_block_pos);\r\n        // 播放掉落动画\r\n        this.next_block.getComponent('block').play_blockDorp().playAdditive('block_drop');\r\n        this.playerComp.set_next_block(this.next_block.getComponent('block'));\r\n    },\r\n\r\n    move_map (offset_x) {\r\n        // 滚动地图\r\n        let m1 = cc.moveBy(0.5, offset_x, -this.y_distance);\r\n        let end_func = cc.callFunc(function () {\r\n            this.creat_block();\r\n        }.bind(this));\r\n        let seq = cc.sequence(m1, end_func);\r\n        this.camera_root.runAction(seq);\r\n    },\r\n\r\n    showScore(score) {\r\n        this.scoreLable.string = score;\r\n    },\r\n\r\n    checkout_game: function() {\r\n        cc.audioEngine.play(this.fall_Audio, false);\r\n        this.scheduleOnce(function() {\r\n            this.endScoreLable.string = this.player.getComponent('player').score;\r\n            this.scoreLable.string = ' ';\r\n            this.checkout.active = true;\r\n        }, 0.2);\r\n    },\r\n\r\n    game_again: function () {\r\n        cc.director.loadScene(\"game_scenes\");\r\n    },\r\n});\r\n"]}